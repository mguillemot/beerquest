<?xml version="1.0"?>
<s:Application xmlns:fx="http://ns.adobe.com/mxml/2009"
               xmlns:s="library://ns.adobe.com/flex/spark"
               xmlns:mx="library://ns.adobe.com/flex/mx"
               xmlns:ui="com.beerquest.ui.*"
               creationComplete="init()"
               width="700" height="480">
    <fx:Script><![CDATA[
        import com.beerquest.Game;

        import mx.controls.Alert;
        import mx.core.FlexGlobals;

        private function init():void {
            try {
                ExternalInterface.addCallback("testJs", testJs);
            } catch (e:Error) {
                trace("Impossible to connect to ExternalInterface.")
            }

            remainingTurns.setProgress(42, 100);
        }

        public function testJs():void {
            Alert.show("coucou de la part du JS!!");
        }

        private function sendAjax():void {
            var request:URLRequest = new URLRequest("/account");
            //            request.contentType = "text/xml";
            //            request.data = dataXML.toXMLString();
            //            request.method = URLRequestMethod.POST;
            var loader:URLLoader = new URLLoader();
            loader.addEventListener(Event.COMPLETE, completeHandler);
            try {
                loader.load(request);
                trace("Request sent.");
            } catch (e:ArgumentError) {
                trace("An ArgumentError has occurred.");
            } catch (e:SecurityError) {
                trace("A SecurityError has occurred.");
            }
        }

        private function completeHandler(event:Event):void
        {
            trace("Request completed.");
            var loader:URLLoader = URLLoader(event.target);
            var variables:URLVariables = new URLVariables(loader.data);
            Alert.show("toto=" + variables.toto);
            //            Alert.show("titi=" + variables.titi);
        }

        private function callJs():void {
            try {
                ExternalInterface.call("callFromFlex", "plup");
            } catch (e:Error) {
                trace("Impossible to connect to ExternalInterface.")
            }
        }

        [Bindable]
        public var game:Game = new Game();
        ]]></fx:Script>
    <ui:PlayerView x="15" y="80" player="{game.me}"/>
    <ui:PlayerView x="505" y="80" player="{game.opponent}"/>
    <mx:Label text="Available moves: {boardView.availableMoves}" x="10" y="10"/>
    <mx:Label text="Combo: {boardView.combo} / Multiplier: x {boardView.multiplier}" x="10" y="30"/>
    <ui:BoardView x="200" y="80" width="300" height="300" id="boardView" game="{game}"/>
    <mx:Label x="10" y="450" text="Token is {FlexGlobals.topLevelApplication.parameters.token}"/>
    <mx:Button x="200" y="450" label="AJAX" click="sendAjax()"/>
    <mx:Button x="300" y="450" label="Call JS" click="callJs()"/>
    <mx:Canvas x="200" y="5" width="300" height="70" backgroundColor="red">
        <mx:Label y="4" x="0" width="300" text="Le Bar du Rond Point" textAlign="center" fontSize="16" fontWeight="bold"/>
        <mx:Label y="23" x="0" width="300" text="(Paris - France)" textAlign="center" fontSize="10"/>
        <mx:ProgressBar id="remainingTurns" y="42" x="10" width="280" trackHeight="10" color="black" maximum="100" mode="manual" label="Fermeture à 23:00 - Encore 15 coups à boire" labelPlacement="center"/>
    </mx:Canvas>
</s:Application>
